# 09__TASK_ROUTER

SCOPE: Universe Engine (UE_V2)
DOC_TYPE: BOOT / ROUTER
UID: UE.V2.BOOT.TASK_ROUTER.001
VERSION: 1.2.0
STATUS: ACTIVE
MODE: REPO (USAGE-ONLY, NO-EDIT)
NAV_RULE: Use RAW links only
PURPOSE: Превращает запрос в DOMAIN + ARTIFACT_TYPE + PIPE + ORC + обязательные проверки (CTL/VAL/QA), с поддержкой STEP-RUN и FOCUS-LOOP.

---

## [M] INTENT
Детерминированно выбрать:
- DOMAIN
- ARTIFACT_TYPE
- PIPE_SELECTED
- DEFAULT_ORC
- REQUIRED_IDX
- REQUIRED_CHECKS (CTL/VAL/QA)
- EXEC_MODE (STEP-RUN / FOCUS-LOOP)

---

## [M] INPUTS
- TASK_TEXT (запрос пользователя)
- OPTIONAL: MODE_HINT (FAST|RELEASE_READY|MASTERPIECE)
- OPTIONAL: CONTEXT_HINTS (platform, duration, vocal, references)

---

## [M] OUTPUTS
- ROUTE_TOKEN:
  - DOMAIN
  - ARTIFACT_TYPE
  - MODE
  - PIPE_SELECTED
  - DEFAULT_ORC
  - REQUIRED_IDX (list)
  - REQUIRED_CHECKS (list)
  - EXEC_MODE
  - FOCUS_HINT (optional)

---

## [M] MODE_RESOLUTION
- "шедевр/как в аптеке" -> MODE=MASTERPIECE
- "быстро/черновик" -> MODE=FAST
- иначе -> MODE=RELEASE_READY

---

## [M] DOMAIN_RULES (HIGH PRIORITY)
R1) "трек/бит/песня/музыка/хук/лирика/текст/сведение/микс/мастер/днк артиста" -> DOMAIN=MUSIC
R2) "обложка/арт/кадр/визуал/промпт для картинок" -> DOMAIN=VIS
R3) "лор/канон/события/персонажи/таймлайн" -> DOMAIN=LOR
R4) "релиз/пак/дистрибуция/метаданные/версии" -> DOMAIN=REL
R5) "законы/стандарты/шаблоны/индексы/структура" -> DOMAIN=CORE

---

## [M] REQUIRED_IDX (ALWAYS BASE)
- UE_V2/04_NAV/00__NAV_ROOT.md
- UE_V2/04_NAV/03__IDX_PIPE.md
- UE_V2/04_NAV/04__IDX_KB.md
- UE_V2/04_NAV/02__IDX_ENT.md
- UE_V2/04_NAV/07__IDX_LEX.md
- UE_V2/04_NAV/08__IDX_REG.md
- UE_V2/04_NAV/09__IDX_XREF.md
- UE_V2/04_NAV/11__IDX_LOG.md

DOMAIN ADDITIONS:
- if DOMAIN=MUSIC -> add UE_V2/04_NAV/12__IDX_MUSIC.md

---

## [M] ARTIFACT_TYPE_RULES (MUSIC)
MUSIC.TRACK:
- PIPE: UE_V2/06_PIPE/20__PIPE_MUSIC_TRACK.md
- ORC: UE_V2/03_ENT/03_ORC/10_MUSIC_ORCHESTRATORS/07__TRACK_BUILD_STEP_ORC.md
- EXEC_MODE: STEP-RUN

MUSIC.HOOK:
- PIPE: UE_V2/06_PIPE/20__PIPE_MUSIC_TRACK.md (hook focus)
- ORC: UE_V2/03_ENT/03_ORC/10_MUSIC_ORCHESTRATORS/08__HOOK_FOCUS_LOOP_ORC.md
- EXEC_MODE: FOCUS-LOOP

MUSIC.LYRICS:
- PIPE: UE_V2/06_PIPE/21__PIPE_MUSIC_LYRICS.md
- ORC: UE_V2/03_ENT/03_ORC/10_MUSIC_ORCHESTRATORS/10__LYRICS_FOCUS_LOOP_ORC.md (узкий фокус) иначе STEP-RUN
- EXEC_MODE: STEP-RUN default

MUSIC.MIX:
- PIPE: UE_V2/06_PIPE/20__PIPE_MUSIC_TRACK.md (mix focus)
- ORC: UE_V2/03_ENT/03_ORC/10_MUSIC_ORCHESTRATORS/09__MIX_FOCUS_LOOP_ORC.md
- EXEC_MODE: FOCUS-LOOP

MUSIC.IDENTITY:
- PIPE: UE_V2/06_PIPE/22__PIPE_MUSIC_IDENTITY.md
- ORC: UE_V2/03_ENT/03_ORC/10_MUSIC_ORCHESTRATORS/11__IDENTITY_BUILD_ORC.md
- EXEC_MODE: STEP-RUN

MUSIC.RELEASE_PACK:
- PIPE: UE_V2/06_PIPE/14__PIPE_REL.md
- ORC: UE_V2/03_ENT/03_ORC/10_MUSIC_ORCHESTRATORS/04__RELEASE_PACK_ORC.md
- EXEC_MODE: STEP-RUN

---

## [M] REQUIRED_CHECKS (MUSIC DEFAULT)
CTL:
- UE_V2/03_ENT/05_CTL/10_MUSIC_CONTROLLERS/14__STEP_BUDGET_CTL.md
- UE_V2/03_ENT/05_CTL/10_MUSIC_CONTROLLERS/15__VARIANT_POLICY_CTL.md
- UE_V2/03_ENT/05_CTL/10_MUSIC_CONTROLLERS/16__FOCUS_LOOP_STOP_RULES_CTL.md

VAL:
- UE_V2/03_ENT/06_VAL/10_MUSIC_VALIDATORS/11__CHAIN_COMPLETENESS_VAL.md
- UE_V2/03_ENT/06_VAL/10_MUSIC_VALIDATORS/12__COVERAGE_PASS_VAL.md
- UE_V2/03_ENT/06_VAL/10_MUSIC_VALIDATORS/13__PROMPT_SPEC_VAL.md (if prompt spec step exists)

QA:
- UE_V2/03_ENT/07_QA/10_MUSIC_QA/10__TRACK_QA_PANEL_QA.md

---

## [M] EXEC_MODE_RULES
- HOOK/MIX -> FOCUS-LOOP
- user command "ещё проход" -> FOCUS-LOOP (current focus)
- иначе -> STEP-RUN

---

## [M] FALLBACKS
- если IDX_MUSIC отсутствует -> GAP (создать IDX_MUSIC)
- если PIPE_MUSIC отсутствует -> GAP (создать доменный пайп)
- если ORC отсутствует -> GAP (создать оркестратор)

---

## [M] GATES
PASS если:
- DOMAIN/ARTIFACT/PIPE/ORC определены
- REQUIRED_IDX включает IDX_MUSIC для музыки
GAP если:
- отсутствует доменный IDX/PIPE/ORC
STOP если:
- нет задачи или MUST_LOAD missing

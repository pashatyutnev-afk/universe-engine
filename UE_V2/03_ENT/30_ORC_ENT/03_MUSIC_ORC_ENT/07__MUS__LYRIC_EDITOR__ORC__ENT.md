FILE: UE_V2/03_ENT/30_ORC_ENT/03_MUSIC_ORC_ENT/07__MUS__LYRIC_EDITOR__ORC__ENT.md
SCOPE: UE_V2 / 03_ENT / 30_ORC_ENT / 03_MUSIC_ORC_ENT
DOC_TYPE: ENTITY_PASSPORT
DOMAIN: MUS_ORC_ENT
UID: UE.V2.ENT.ORC.MUS.LYRIC_EDITOR.001
VERSION: 1.1.0
STATUS: ACTIVE
MODE: REPO (USAGE-ONLY, NO-EDIT)
CREATED: 2026-02-02
UPDATED: 2026-02-04
OWNER: ORC_ENT
NAV_RULE: No RAW in entity docs

---

## [M] ENTITY_HEADER
- ENTITY_NAME: MUS_LYRIC_EDITOR
- ENTITY_CLASS: ORC
- UID: UE.V2.ENT.ORC.MUS.LYRIC_EDITOR.001

---

## [M] PURPOSE
Доводит LYRICS_DRAFT до LYRICS_FINAL: ритм, рифма, ясность, “пение-в-голове”, чистая пунктуация.
Жёстко убирает восклицательные знаки и любые строки, начинающиеся с "!".
Формирует EDIT_NOTES: что именно улучшено, что заблокировано, что требует переделки.

---

## [M] INPUTS / OUTPUTS
- Inputs:
  - LYRICS_DRAFT
  - LYRIC_BRIEF
- Outputs:
  - LYRICS_FINAL
  - EDIT_NOTES
  - FAIL_CODE?

---

## [M] SCOPE & NON-GOALS
- В рамках: правка текста, структуры, рифмы, ритмики, повторяемости, ясности образов, устранение мусора.
- Не делать:
  - Не менять смысловую ось без причины.
  - Не добавлять новые сюжетные ветки, которых нет в LYRIC_BRIEF, кроме мелких “склеек” для плавности.
  - Не менять жанровую подачу, если это не требуется явным правилом брифа.

---

## [M] CORE_RULES
1) Смысл
- Сохранять смысловую ось, тон и POV из LYRIC_BRIEF.
- Убирать провалы смысла: “пустые” строки, несвязанные образы, логические скачки.

2) Хук и повторяемость
- Хук должен быть легко запоминаемым, коротким и повторяемым.
- Повторяемость допускается, но без “пережёвывания”: каждый повтор усиливает эмоцию или образ.

3) Ритм и “пение-в-голове”
- Делать строки проговариваемыми на одном дыхании.
- Убирать тяжёлые согласные связки, ломанные ударения, слишком длинные строки.

4) Рифма
- Если рифма заявлена в брифе: усиливать и выравнивать.
- Если рифма не обязательна: приоритет — флоу, ясность, музыкальность.
- Избегать дешёвых/очевидных рифм там, где они ломают образ.

5) Пунктуация и запреты
- Пунктуация: без "!" и без строк, начинающихся с "!".
- Любые найденные "!" заменять на ".", "—", "…" или перестройкой фразы.
- Сохранять читабельность, не превращать текст в “сплошной поток”.

6) Чистота языка
- Убирать лишние слова, тавтологии, паразиты, канцелярит.
- Следить за единым регистром: если стиль “капсом” — делать последовательно по правилам проекта, иначе нормальный регистр.

---

## [M] EDIT_FLOW (DETERMINISTIC)
S1) Sanitizer
- Удалить "!" и строки, начинающиеся с "!". Зафиксировать в EDIT_NOTES.

S2) Structure lock
- Проверить структуру (куплеты/припев/бридж/аутро) против LYRIC_BRIEF.
- Если структура конфликтует и починить нельзя без переписывания: FAIL.

S3) Meaning pass
- Убрать смысловые провалы, привести образы к одной линии, склеить переходы.

S4) Hook pass
- Укоротить и усилить хук, сделать повторяемым, убрать лишние слова.

S5) Flow pass
- Подровнять длины строк, убрать “ломаные” места, упростить дикцию.

S6) Rhyme pass (conditional)
- Если требуется: выровнять рифмы и окончания.
- Если не требуется: оставить естественность, не ломая флоу.

S7) Final polish
- Финальная пунктуация: ".", "—", "…" по месту.
- Проверка читаемости вслух.

---

## [M] OUTPUT_FORMAT
LYRICS_FINAL:
- Текст с явной структурой блоков (VERSE / CHORUS / BRIDGE / OUTRO), если она есть в черновике или брифе.
- Без "!".
- Без строк, начинающихся с "!".

EDIT_NOTES:
- Changes: список ключевых правок (bullet list).
- Risks: что может не зайти (рифма, длина строк, спорные образы).
- Assumptions: что было принято как данность из LYRIC_BRIEF.
- Blockers: если есть — что мешает финалу.

---

## [M] FAIL_CONDITIONS
FAIL, если:
- Невозможно убрать запреты без разрушения смысла.
- Структура противоречит LYRIC_BRIEF и не лечится локальными правками.
- Хук отсутствует там, где он обязателен по брифу, и его нельзя вывести без полного переписывания.
- В тексте остаются "!" или строки, начинающиеся с "!".

---

## [M] GATES
- PASS:
  - LYRICS_FINAL готов к генерации и не нарушает запреты
  - Хук читается и запоминается
  - Текст звучит вслух ровно
- FAIL:
  - Конфликт структуры или запретов
  - Нельзя получить финал без полного переписывания

---

## [M] SPC PEER ROLES (NON-ENG)
- Works with: [QA]
- Handoff:
  - LYRICS_FINAL -> MUS.PROMPT_PACKAGER
  - LYRICS_FINAL -> MUS.QA_CHECKS
  - LYRICS_FINAL -> MUS.TRACK_TEST_DOC_GATE

---

## [M] CHANGELOG
- 2026-02-02: v1.0.0 init
- 2026-02-04: v1.1.0 expanded deterministic flow, fail conditions, output format

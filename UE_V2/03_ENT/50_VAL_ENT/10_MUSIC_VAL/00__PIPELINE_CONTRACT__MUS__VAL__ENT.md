FILE: UE_V2/03_ENT/50_VAL_ENT/10_MUSIC_VAL/00__PIPELINE_CONTRACT__MUS__VAL__ENT.md
SCOPE: UE_V2 / 03_ENT / 50_VAL_ENT / 10_MUSIC_VAL
DOC_TYPE: PIPELINE_CONTRACT
DOMAIN: MUS_VAL_ENT
UID: UE.V2.ENT.PIPE.MUS_VAL_ENT.001
VERSION: 1.0.0
STATUS: ACTIVE
MODE: REPO (USAGE-ONLY, NO-EDIT)
CREATED: 2026-02-02
UPDATED: 2026-02-02
OWNER: VAL_ENT
NAV_RULE: Contract has no RAW

---

## [M] PURPOSE
PIPELINE_CONTRACT — роутер музыкальных валидаторов (VAL).
Определяет порядок проверок и правила конфликтов решений. Возвращает KEYS only.
RAW не хранит: всё через KEY и INDEX_MANIFEST.

## [M] HARD_RULES
- RAW запрещён внутри CONTRACT.
- Все ссылки: только KEYS.
- MODE REPO: никаких правок репозитория.
- Выход: VAL_CHAIN_PLAN (KEYS) + PRIORITY_ORDER + CONFLICT_RULES.

## [M] REQUIRED_KEYS
- INDEX_MANIFEST
- PIPELINE_CONTRACT
- VAL.MUS.PD_ONLY
- VAL.MUS.COLLISION_BLOCKER
- VAL.MUS.CREDITS_RIGHTS
- VAL.MUS.RELEASE_PACK_READY
- VAL.MUS.CHAIN_COMPLETENESS

## [M] PRIORITY_ORDER (highest first)
1) VAL.MUS.PD_ONLY
2) VAL.MUS.COLLISION_BLOCKER
3) VAL.MUS.CREDITS_RIGHTS
4) VAL.MUS.NAMING_COLLISION
5) VAL.MUS.PROMPT_SPEC
6) VAL.MUS.PROMPT_FIDELITY
7) VAL.MUS.CHAIN_COMPLETENESS
8) VAL.MUS.RELEASE_PACK_READY
9) VAL.MUS.COVERAGE_PASS
10) VAL.MUS.HOOK_TIMING (conditional if UGC/shortform)
11) VAL.MUS.UGC_READY (conditional if UGC/shortform)
12) VAL.MUS.REPEAT_GUARD
13) VAL.MUS.VOICE_DIVERSITY
14) VAL.MUS.SYNTHESIS_COHERENCE

## [M] CONFLICT_RULES
- FAIL dominates everything (stop, return REQUIRED_FIXES + VIOLATIONS).
- ASK dominates PASS/WARN (request minimal missing evidence).
- WARN returns REQUIRED_FIXES but may continue chain.
- PASS only when no higher-severity result exists.

## [M] DEFAULT_CHAIN_PLAN (keys)
- ALWAYS:
  - VAL.MUS.PD_ONLY
  - VAL.MUS.COLLISION_BLOCKER
  - VAL.MUS.CREDITS_RIGHTS
  - VAL.MUS.NAMING_COLLISION
  - VAL.MUS.PROMPT_SPEC
  - VAL.MUS.PROMPT_FIDELITY
  - VAL.MUS.CHAIN_COMPLETENESS
  - VAL.MUS.RELEASE_PACK_READY
  - VAL.MUS.COVERAGE_PASS
  - VAL.MUS.REPEAT_GUARD
  - VAL.MUS.VOICE_DIVERSITY
  - VAL.MUS.SYNTHESIS_COHERENCE
- CONDITIONAL:
  - If MUS_BRIEF indicates UGC/shortform -> add VAL.MUS.HOOK_TIMING and VAL.MUS.UGC_READY

## [M] STEP-RUN
- STEP: S0
  GOAL: Build validator chain keys
  INPUTS: [MUS_BRIEF?, ARTIFACT_HINTS?]
  TARGETS: [INDEX_MANIFEST]
  ACTIONS:
    - Select conditional validators if UGC/shortform
    - Output VAL_CHAIN_PLAN (KEYS only)
  OUTPUTS: [VAL_CHAIN_PLAN]
  CHECKS: [REQUIRED_KEYS_PRESENT]
  FAIL: UE.FAIL.MISSING_KEY
  NEXT: "го"

- STEP: S1
  GOAL: Execute chain and resolve decision conflicts
  INPUTS: [VAL_CHAIN_PLAN, CONTEXT_TOKENS]
  TARGETS: []
  ACTIONS:
    - Apply validators in PRIORITY_ORDER
    - Aggregate using CONFLICT_RULES
  OUTPUTS: [VAL_AGG_DECISION, REQUIRED_FIXES, VIOLATIONS]
  CHECKS: [DECISION_PRODUCED]
  FAIL: UE.FAIL.GATE_FAIL
  NEXT: "го"

## [M] FAIL_CODES
- UE.FAIL.MISSING_KEY
- UE.FAIL.GATE_FAIL
- UE.FAIL.RULE_VIOLATION
- UE.FAIL.INPUT_ABSENT

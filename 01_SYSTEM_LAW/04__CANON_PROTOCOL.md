# UNIVERSE ENGINE — CANON PROTOCOL
FILE: 01_SYSTEM_LAW/04__CANON_PROTOCOL.md

SCOPE: Universe Engine
LAYER: SYSTEM LAW
LEVEL: L0
STATUS: ACTIVE
LOCK: OPEN
VERSION: 1.0
OWNER: SYSTEM
ROLE: Протокол изменения канона. Определяет, что считается каноном, как вносятся изменения, как фиксируются решения и как предотвращаются конфликтующие правки.

---

## 0) PURPOSE
Canon Protocol нужен чтобы:
- изменения были контролируемыми
- система не расползалась в дубли/конфликты
- любые правки имели след, причину и последствия

---

## 1) WHAT IS CANON (DEFINITION)
Канон — это всё, что одновременно:
1) находится в канонической структуре системы
2) зарегистрировано в соответствующем INDEX (Existence Rule)
3) имеет корректную шапку (STATUS/LOCK/VERSION/OWNER/ROLE)
4) не конфликтует с законами/стандартами выше уровнем

Если хотя бы одно условие не выполнено — это NON-CANON.

---

## 2) CANON CHANGE TYPES
Изменения делятся на типы:

### A) STRUCTURAL CHANGE
- новый слой/папка/перестройка структуры
- переименование путей
- слияние/разделение реестров

### B) RULE CHANGE
- изменения LAW / STANDARDS
- изменение обязательных требований

### C) ENTITY CHANGE
- добавление/удаление/изменение ENT (ENG/ORC/SPC/CTL/VAL/QA)
- изменение mini-contract
- изменение зависимостей

### D) CONTENT CHANGE
- изменение KB/PRJ/OUT контента без изменения форматов/правил

---

## 3) CHANGE FLOW (MANDATORY PIPELINE)
Любая каноническая правка проходит один и тот же пайплайн:

### STEP 1 — REGISTER (INDEX FIRST)
Сначала изменение регистрируется в INDEX:
- новый файл: добавляется строка в INDEX (номер/имя/ссылка)
- новая сущность: добавляется в INDEX_ALL_* реестр
- новая спецификация: добавляется в стандартный индекс

Запрещено: создавать файл и “потом когда-нибудь” добавить в индекс.

### STEP 2 — APPLY CHANGE
- создаётся или правится сам файл
- соблюдаются стандарты маркировки
- фиксируются зависимости (если есть)

### STEP 3 — IMPACT CHECK
Для любого изменения описывается:
- что затронуто (files/entities)
- какие зависимости ломаются/меняются
- требуется ли миграция

### STEP 4 — LOG DECISION
Результат фиксируется в логах/реестре решений:
- что изменили
- почему
- какая версия стала актуальной

---

## 4) LOCK RULE (CRITICAL)
LOCK определяет, можно ли править документ:

- LOCK: FIXED
  - правки запрещены
  - допускается только новая версия файла/замена через Canon Protocol

- LOCK: OPEN
  - правки разрешены
  - но версия обязана обновляться

---

## 5) VERSION RULE (MANDATORY)
Версия обязана меняться при любом meaningful change.

Рекомендуемый смысл:
- PATCH (x.y.Z): опечатки, формат, мелкие уточнения без изменения смысла
- MINOR (x.Y.z): добавления/улучшения без ломки совместимости
- MAJOR (X.y.z): breaking change, меняет правила или структуру

---

## 6) NO DUPLICATION (ANTI-DRIFT)
Запрещено:
- иметь два документа с одинаковой функцией (двойной SoT)
- хранить “копию стандарта” в другом месте
- переписывать правила в проектах, если есть стандарт

Если нужно уточнение:
- добавляешь в SoT документ
- либо создаёшь модуль-расширение и регистрируешь его

---

## 7) BREAKING CHANGE RULE
Breaking change допускается только если:
- явно помечено как BREAKING
- описаны последствия и миграция
- указано, что считается “устаревшим”

---

## 8) CANON VALIDATION (MINIMUM)
Перед тем как считать change “принятым”:
- обновлены индексы
- нет конфликтов с SYSTEM LAW и SoT
- зависимости задекларированы
- документ проходит Doc Control (шапка/маркировка)

---

## 9) FINAL LAW
> Канон меняется только через индекс + протокол.  
> Всё остальное — временное и не имеет силы.

OWNER: Universe Engine  
LOCK: FIXED

---
END.

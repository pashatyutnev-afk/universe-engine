# VERSIONING & CHANGE POLICY (CANON)
FILE: 01_SYSTEM_LAW/03__VERSIONING_CHANGE_POLICY.md

SCOPE: Universe Engine
LAYER: 01_SYSTEM_LAW
DOC_TYPE: LAW
LEVEL: L1
STATUS: ACTIVE
LOCK: FIXED
VERSION: 1.1.0
UID: UE.LAW.VERSIONING.003
OWNER: SYSTEM
ROLE: Defines SemVer versioning, change classification, mandatory change notes, deprecation rules, and canon-impact gates.

CHANGE_NOTE:
- DATE: 2026-01-07
- TYPE: MINOR
- SUMMARY: "Единый SemVer MAJOR.MINOR.PATCH + классификация изменений + обязательный Change Note + deprecation/migration правила"
- REASON: "Устранение semver-lite и неоднозначности"
- IMPACT: "Все канонические слои и документы"

---

## 0) PRIME LAW (ABSOLUTE)
Каждый канонический документ/реестр/спека должен:
- иметь версию в формате SemVer `MAJOR.MINOR.PATCH`,
- фиксировать изменения через Change Note,
- не менять канон без Canon Protocol.

---

## 1) SEMVER FORMAT (CANON)
### 1.1 Формат
`MAJOR.MINOR.PATCH`

- **MAJOR** — несовместимые изменения (breaking)
- **MINOR** — совместимые добавления/расширения
- **PATCH** — исправления без изменения смысла интерфейса/правил

Примеры:
- `1.0.0` — первая стабильная версия
- `1.1.0` — добавили новые правила/разделы без ломки
- `1.1.1` — исправили формулировки/ошибки без изменения смысла

### 1.2 Запрет semver-lite
Запрещены версии вида:
- `1.0` (без PATCH)
- `v1` / `v1.0`
- `2026.01` (если не зафиксировано отдельным законом)

---

## 2) CHANGE CLASSIFICATION (WHAT KIND OF CHANGE IS IT?)
### 2.1 PATCH (x.y.Z)
PATCH = исправление, не меняющее интерфейс/правило системы:
- опечатки, грамматика
- уточнения, не меняющие смысл
- фиксы ссылок/путей без изменения состава и правил
- косметика структуры (перестановка разделов) без изменения норм

### 2.2 MINOR (x.Y.z)
MINOR = добавление или расширение без ломки существующих контрактов:
- добавили новые разделы/термины/примеры
- добавили новые допустимые значения, не запрещая старые
- добавили новые registry поля, но старые остаются валидны
- расширили перечень REL types, не меняя старые

### 2.3 MAJOR (X.y.z)
MAJOR = breaking change:
- поменяли правило так, что старые документы/артефакты становятся невалидными
- поменяли формат UID/схем/артефакт-типов
- переопределили authority, existence rules
- изменили обязательные поля, порядок или смысл, требующий миграции
- удалили или заменили SoT

---

## 3) WHAT COUNTS AS CANON CHANGE
Канон-изменение — любое изменение, которое влияет на:
- состав master-index (добавили/удалили/переупорядочили зарегистрированные файлы)
- смысл закона/спеки/протокола (нормативные изменения)
- схемы артефактов и пайплайны
- UID правила, naming правила, governance правила
- SoT документы и их модульные связи

### 3.1 Не канон-изменение (local only)
Не считается канон-изменением:
- черновики вне индексов
- notes с `LOCK: OPEN` и без регистрации
- экспериментальные файлы вне канона

---

## 4) CHANGE NOTE (MANDATORY FORMAT)
Каждый канонический документ обязан содержать блок `CHANGE_NOTE` в шапке.
Минимальные поля:

CHANGE_NOTE:
- DATE: YYYY-MM-DD
- TYPE: PATCH | MINOR | MAJOR
- SUMMARY: "one-line summary"
- REASON: "why this change was needed"
- IMPACT: "what parts/layers are affected"

### 4.1 Правило актуальности Change Note
Change Note описывает **последнее изменение** в текущей версии.
История изменений ведётся:
- либо в отдельном CHANGELOG документе слоя,
- либо в git/PR истории (если система так решит через Canon Protocol).

---

## 5) DEPRECATION POLICY (HOW WE KILL OLD THINGS)
### 5.1 Статусы устаревания
Если документ/правило устаревает, применяется один из вариантов:

- `STATUS: DEPRECATED` — документ остаётся, но не используется как SoT
- `STATUS: ARCHIVED` — документ заморожен, сохраняется для истории
- `STATUS: ACTIVE` — действующий

### 5.2 Deprecated-by link (обязательная ссылка)
У DEPRECATED документа должен быть явный указатель:
- `DEPRECATED_BY: <UID_TARGET>` (или XREF строка)

### 5.3 Migration window
Для MAJOR изменений обязателен MIGRATION PLAN:
- что мигрировать
- как определить затронутые документы/артефакты
- дедлайн (если нужен)
- кто владелец миграции

---

## 6) FILE MOVES / RENAMES (PATH CHANGES)
### 6.1 Переименование файла
Переименование файла:
- не меняет UID
- требует обновления ссылок в индексах/реестрах
- может быть PATCH (если смысл не меняется)

### 6.2 Перемещение между папками
Перемещение между папками:
- должно быть отражено в master-index
- требует проверки authority/слоя
- обычно MINOR, иногда MAJOR (если ломает пайплайн/ссылки)

---

## 7) RELEASE DISCIPLINE (MINIMUM GATES)
Перед фиксацией канонической версии документ должен пройти минимум:
- Doc Control (шапка полная и единая)
- UID присутствует и уникален
- Naming Rules соблюдены
- Индексы обновлены (если менялся состав/путь)
- Нет дублей смысла (Single SoT)

---

## FINAL RULE (LOCK)
SemVer и Change Policy обязательны для всех канонических слоёв.
Любая правка этого закона — MAJOR по умолчанию (ломает систему контроля).
--- END.

# Narrative Logic Engine
FILE: 01__NARRATIVE_LOGIC_ENG.md

SCOPE: Universe Engine
ENTITY_GROUP: ENGINES (ENG)
FAMILY: 02_DOMAIN_NARRATIVE_ENGINES
LEVEL: L2
STATUS: ACTIVE
VERSION: 1.0
ROLE: Ensures causal logic, intent logic, and state-change logic in narrative

---

## PURPOSE

Гарантирует, что история **логична как система**:
- причинно-следственная цепь не рвётся
- мотивы персонажей согласованы с действиями
- изменения мира/отношений объяснимы
- "случайность" используется контролируемо

---

## INPUTS

- Events (E): список событий (включая внешние удары)
- Actors (A): кто участвует
- Intents (I): желания/цели/страхи
- Constraints (C): законы мира, ресурсы, запреты
- Current State (S): статус-кво до события

---

## OUTPUTS

- Causal Graph (G): граф причинности (cause → effect)
- Justification Notes: почему событие возможно и почему оно случилось
- Flag List: логические дыры, совпадения, нарушения мотивации
- Required Bridges: какие сцены/факты надо добавить, чтобы закрыть дырки

---

## CORE MODEL

### Event Types
- Intent-driven: вызвано решениями персонажей
- Constraint-driven: вызвано законами мира/обстоятельствами
- External shock: внешняя сила/катастрофа/вмешательство
- Randomness: допустимо только если:
  - (a) не решает ключевую проблему вместо героя
  - (b) имеет цену/последствие
  - (c) не ломает мотивации и канон

---

## PROCEDURE (CANON)

1) **State Snapshot**
   - зафиксировать S0: кто где, что хочет, какие ограничения

2) **For each event**
   - определить тип события
   - указать "Причину" (cause)
   - указать "Механизм" (how it happens under constraints)
   - указать "Изменение" (что поменялось: info/position/relationship/risk)

3) **Build Causal Graph**
   - соединить cause → effect
   - проверить: есть ли “висящие эффекты” без причины

4) **Intent Consistency Check**
   - каждое ключевое действие должно иметь:
     - цель (goal)
     - цену (cost)
     - риск (risk)
     - причину выбора (why this option)

5) **Coincidence Audit**
   - совпадение допустимо только если:
     - оно ухудшает положение (делает хуже), либо
     - оно открывает проблему, но не решает её

6) **Output Bridges**
   - если дыра — предложить минимальную сцену/факт, который чинит цепь

---

## VALIDATION RULES

- L1: Нельзя получить эффект без причины (кроме внешнего удара, который помечен).
- L2: Герой не может действовать против мотива без:
  - психологического триггера, или
  - давления обстоятельств, или
  - новой информации.
- L3: Решение ключевого конфликта не может быть подарком случайности.
- L4: Любое изменение состояния фиксируется и влияет дальше.

---

## FAILURE MODES

- Deus ex machina
- Телепортации фактов (инфа появляется из ниоткуда)
- Нарушение компетенций мира (персонаж умеет то, что не умеет)
- "Персонаж тупеет" ради сюжета
- Случайность спасает в кульминации

---

## INTEGRATION

- With CAUSE_EFFECT_ENG (Expression): более детализированная причинность сцен.
- With CHARACTER engines: мотивы/психология как источник решений.
- With WORLD_LAW_ENG: проверка “возможно ли это”.
- With CONTINUITY_ENG: фактология и состояния.

---
OWNER: Universe Engine
STATUS: FIXED
